# Sega Mega Drive / Genesis Test Project Template

This project serves as a basic template and testbed for Sega Mega Drive (Genesis) development using the SGDK (Sega Genesis Development Kit). It demonstrates fundamental concepts such as:

*   Basic project structure
*   Loading screen with company logo placeholder.
*   Interactive test menu for selecting different demos/tests.
*   Graphics rendering (tiles and sprites)
*   Sprite animation (frame-by-frame)
*   Sound effects (PCM playback)
*   Screen transitions (fade-in/fade-out)
*   Controller input handling

The aim is to provide a starting point that can be easily copied and extended for new game projects.

## Features Demonstrated

*   **Loading Screen:** Displays a logo (`logo_minnka.png`) for a few seconds at startup, skippable with the Start button.
*   **Interactive Test Menu:** Allows navigation and selection of different test modules using the D-Pad and Start/A buttons.
*   **Graphics:**
    *   Loading and displaying tile-based backgrounds (via "Show Tilemap" menu option).
    *   Loading and displaying hardware sprites (via "Show Sprite Demo" menu option).
    *   Player-controlled sprite movement (in "Show Sprite Demo").
*   **Animation:**
    *   Simple 2-frame animation for the player sprite (in "Show Sprite Demo").
    *   Animation timing handled in `animation.c`.
*   **Sound:**
    *   Playing a PCM sound effect triggered by controller input (Button A in "Show Sprite Demo").
    *   Sound data is provided as a raw PCM file (`res/sfx/sfx_ping.raw`) which is compiled by `rescomp`.
*   **Transitions:**
    *   Fade-out to black and fade-in from black effects (demonstrated in "Test Fades" and when launching the "Show Sprite Demo").
*   **Input:**
    *   Reading D-Pad for player movement (in "Show Sprite Demo") and menu navigation.
    *   Reading Start/A buttons for menu selection and skipping the loading screen.
    *   Displaying raw controller input state (in "Test Inputs").
    *   Basic input abstraction in `input.c` and edge detection in `menu.c`.

## Project Structure

```
megadrive_test_project/
├── inc/                # Header files (.h) for project modules
│   ├── animation.h
│   ├── graphics.h
│   ├── input.h
│   ├── input_test.h    # For the input display test module
│   ├── menu.h          # For the interactive menu system
│   ├── sound.h
│   ├── transitions.h
│   └── resources.h     # Generated by rescomp for SGDK resources
├── src/                # Source files (.c) for project modules
│   ├── animation.c
│   ├── graphics.c
│   ├── input.c
│   ├── input_test.c    # For the input display test module
│   ├── main.c          # Main application entry point & state machine
│   ├── menu.c          # For the interactive menu system
│   ├── sound.c
│   └── transitions.c
│   └── resources.c     # Generated by rescomp
├── res/                # Game assets (graphics, sound, etc.)
│   ├── gfx/
│   │   ├── logo_minnka.png    # Logo image for loading screen (256x224)
│   │   ├── sprite_player.png  # Player sprite sheet (32x16, 2 frames)
│   │   └── tileset.png      # Example tileset (128x8)
│   ├── sfx/                # Sound effects (original sfx_ping.wav removed, sound is hardcoded)
│   └── resources.res     # SGDK resource definition file
├── out/                # Compiled output (ROM, etc.) - gitignored
├── obj/                # Object files from compilation - gitignored
├── .gitignore          # Specifies intentionally untracked files
└── makefile            # Makefile for compiling the project with SGDK
```

## Prerequisites

1.  **SGDK (Sega Genesis Development Kit):** You need to have SGDK installed and configured on your system.
    *   Official SGDK releases: [https://github.com/Stephane-D/SGDK/releases](https://github.com/Stephane-D/SGDK/releases)
    *   Setup instructions: Follow the documentation on the SGDK GitHub or website ([https://sgdk.tech](https://sgdk.tech)).
    *   Ensure the `GENDEV` environment variable is set to your SGDK installation path (e.g., `C:/sgdk` or `/opt/gendev/sgdk`), or that `SGDK_BASE_DIR` is correctly set in the `makefile` or your environment. The makefile attempts to use `$(GENDEV)/sgdk`.

2.  **Mega Drive Emulator:** For testing the compiled ROM (`.bin` file).
    *   Examples: Gens, BlastEm, Mednafen, RetroArch (with Genesis core).

## Compilation

1.  Open a terminal or command prompt.
2.  Navigate to the `megadrive_test_project` directory.
3.  Run the make command:
    ```bash
    make
    ```
    This will compile the project and create `out/rom.bin`.
4.  To clean build files:
    ```bash
    make clean
    ```

If you encounter issues with `SGDK_BASE_DIR` not being found, ensure your `GENDEV` environment variable is set correctly, or manually edit the `SGDK_BASE_DIR` path at the top of the `makefile`.

## Application Flow and Using the Modules

The application now follows a state-driven flow managed in `main.c`:

1.  **Loading Screen:**
    *   The application starts with a "Minnka" logo loading screen (`logo_minnka.png`).
    *   This screen is displayed for a few seconds or can be skipped by pressing the Start button.
2.  **Main Test Menu (`menu.c`, `menu.h`):**
    *   After the loading screen, the application transitions to the main Test Menu.
    *   **Navigation:** Use D-Pad Up/Down to highlight a test option.
    *   **Selection:** Press Start or Button A to run the selected test.
    *   The menu system handles drawing the options and user input for selection.
3.  **Test Modules:**
    *   **Show Sprite Demo:** (Graphics: `graphics.c`, Animation: `animation.c`, Sound: `sound.c`)
        *   Demonstrates sprite animation, player-controlled movement using the D-Pad, and sound effects when Button A is pressed.
        *   Press Start to return to the main menu.
    *   **Show Tilemap:** (Graphics: `graphics.c`)
        *   Displays a static tilemap example using `load_simple_tileset()` and `display_simple_tilemap()`.
        *   Press Start to return to the main menu.
    *   **Test Fades:** (Transitions: `transitions.c`)
        *   Shows a sequence of screen fade-out to black and fade-in from black effects.
        *   Press Start to return to the main menu after the sequence completes.
    *   **Test Inputs:** (Input Test: `input_test.c`, `input_test.h`, Core Input: `input.c`)
        *   Displays the current state (pressed/released) of controller buttons and D-Pad directions, as well as the raw hexadecimal state value.
        *   Press Start to return to the main menu.

Each test module returns to the main menu by pressing the Start button, allowing for easy navigation between different demonstrations.

## Adding New Tests

The project is designed to be easily extendable with new test modules:

1.  **Implement Test Logic:**
    *   Create new `.c` and `.h` files for your test if it's complex (e.g., `my_test.c`, `my_test.h`), or add logic to existing modules if appropriate.
    *   Your test should have at least an initialization function (e.g., `my_test_init()`) and potentially an update function if it's interactive or animated (e.g., `my_test_update()`).
2.  **Define GameState:**
    *   In `main.c`, add a new value to the `GameState` enum (e.g., `STATE_MY_NEW_TEST`).
3.  **Add to Menu:**
    *   In `menu.c`, add the display name of your test to the `static const char* menu_items[]` array.
    *   Increment `MAX_MENU_ITEMS` in `menu.h` to match the new total number of menu items.
4.  **Create State Initialization Function:**
    *   In `main.c`, create a new static function `init_my_new_test_state()` that:
        *   Performs any setup required for your test (e.g., clearing the screen, loading specific graphics/palettes, calling your `my_test_init()`).
        *   Sets `current_game_state = STATE_MY_NEW_TEST;`.
5.  **Integrate into Menu Logic:**
    *   In `main.c`, within the `update_menu_state()` function, add a `case` to the `switch (selected_test_index)` statement that corresponds to your new menu item's index. This case should call `init_my_new_test_state()`.
6.  **Implement Update and Exit Logic:**
    *   In `main.c`, add a `case STATE_MY_NEW_TEST:` to the main game loop's `switch` statement.
        *   If your test is static (just displays something), this case might only need to check for the Start button press to call `return_to_menu()`.
        *   If your test is interactive or animated, call your `my_test_update()` function here, and also check for the Start button to return to the menu.

## Asset Conversion Tools (SGDK)

SGDK comes with tools to convert assets into formats usable by the Mega Drive:
*   **`rescomp`:** The resource compiler. It processes the `resources.res` file and converts images, sound, etc., into C arrays or binary data linked into your ROM. It can handle:
    *   Images (`.png`, `.bmp`) for tilesets, sprites, and full-screen images like the logo.
    *   WAV files (`.wav`) or raw PCM files (`.raw`) for sound effects. Our current SFX is a raw PCM file.
    *   Music tracker files (e.g., XGM, TFM).
*   **`xgmtool`:** For advanced sound/music using the XGM driver (not used in this basic sound example but common for music).
*   Image editors (GIMP, Aseprite, etc.) are used to create the base assets.

This template provides a foundation. Feel free to experiment, expand, and build upon it!
```
